import{P as c,C as y,a as h,W as S,r as p,t as w,c as T,u as C}from"./wheel-8b18538e.js";import{u as M,_ as g,o as i,c as s,d as v,a,b as R,F as f,r as m,n as d,t as $,m as k,e as x,f as z,p as _,g as b}from"./index-8ef6bb9d.js";const V={props:{id:{required:!0},mainDirection:{type:c,default:null,required:!1}},data(){return{resizeStartAnchor:null,currentTouch:null}},computed:{cursorStore(){return M()}},emits:["cursor-move","cursor-down","cursor-up"],methods:{onMouseDown(e){console.log("mouse-down"),this._cursorDown(e.clientX,e.clientY)},onMouseUp(e){console.log("mouse-up"),this._cursorUp(e.clientX,e.clientY)},onMouseMove(e){console.log("mouse-move"),this._cursorMove(e.clientX,e.clientY)},onTouchStart(e){e.preventDefault(),console.log("touch-down"),e.touches.length>0&&(this.currentTouch=e.touches[0],this._cursorDown(this.currentTouch.clientX,this.currentTouch.clientY))},onTouchMove(e){if(console.log("touch-move"),!this.currentTouch)return;const t=e.changedTouches;for(let o=0;o<t.length;o++)if(this.currentTouch.identifier===t[o].identifier){this._cursorMove(t[o].clientX,t[o].clientY);return}},onTouchEnd(e){if(console.log("touch-end"),!this.currentTouch)return;const t=e.changedTouches;for(let o=0;o<t.length;o++)if(this.currentTouch.identifier===t[o].identifier){this._cursorUp(t[o].clientX,t[o].clientY);return}},_cursorDown(e,t){this.resizeStartAnchor=this.toRelative(e,t);const[o,n]=this.toProjected(this.resizeStartAnchor);this.$emit("cursor-down",o,n),this.cursorStore.root&&(this.cursorStore.root.onmousemove=this.onMouseMove,this.cursorStore.root.onmouseup=this.onMouseUp,this.cursorStore.root.ontouchmove=this.onTouchMove,this.cursorStore.root.ontouchend=this.onTouchEnd)},_cursorMove(e,t){if(!this.resizeStartAnchor)return;const o=this.toRelative(e,t).subtract(this.resizeStartAnchor),[n,r]=this.toProjected(o);this.$emit("cursor-move",n,r)},_cursorUp(e,t){if(this.resizeStartAnchor){const o=this.toRelative(e,t).subtract(this.resizeStartAnchor),[n,r]=this.toProjected(o);this.$emit("cursor-up",n,r)}this.resizeStartAnchor=null,this.cursorStore.root&&(this.cursorStore.root.onmousemove=null,this.cursorStore.root.onmouseup=null)},centeredRect(){let e=this.$el.getBoundingClientRect();return console.log(`rect: ${e.left} ${e.top} ${e.right} ${e.bottom}`),new y(new c((e.right+e.left)/2,(e.bottom+e.top)/2),new c((e.right-e.left)/2,(e.bottom-e.top)/2))},toRelative(e,t){let o=this.centeredRect();console.log(`Client pointer=[${e}, ${t}]`),console.log(`centered rect: center=[${o.center.x}, ${o.center.y}] halfSize=[${o.halfSize.x}, ${o.halfSize.y}]`);const n=new c((e-o.center.x)/o.halfSize.x,(t-o.center.y)/o.halfSize.y);return console.log(`relative [${n.x}, ${n.y}]`),n},toProjected(e){if(!this.mainDirection)return[e,new c(0,0)];const t=e.projectOn(this.mainDirection),o=e.subtract(t);return console.log(`Projection [${t.x}, ${t.y}]`),[t,o]}}};function D(e,t,o,n,r,l){return i(),s("div",{class:"resize-eventor-root",onMousedown:t[0]||(t[0]=(...u)=>l.onMouseDown&&l.onMouseDown(...u)),onTouchstart:t[1]||(t[1]=(...u)=>l.onTouchStart&&l.onTouchStart(...u))},null,32)}const W=g(V,[["render",D]]),A={class:"outer"},F={class:"inner"},N=["viewBox"],j=["id","d"],P={fill:"white"},U=["font-size"],E={props:{id:{type:String,default:"0"},title:{type:String,default:"Some Title"},radius:{type:Number,default:1},rotation:{type:Number,default:0},angle:{type:Number,default:90},space:{type:String,default:"1rem"},axWidth:{type:String,default:"0.2rem"},axTicks:{default:()=>[0,10]},color:{type:String,default:"#af0000"},animationSpeed:{type:String,default:"0.5s"},titleFrac:{type:Number,default:.03}},emits:["update-rotation","update-radius"],mounted(){console.log(`Created sector ${this.title} with radiusScale=${this.radius}`)},data(){return{referenceRadius:0}},methods:{onResize(e,t){console.log(`New Point: ${e.x}, ${e.y}, diag=${e.diag()}`),this.$emit("update-radius",this.id,this.calcNewRadius(e),!1)},onResizeStart(){this.referenceRadius=this.radius},onResizeEnd(e,t){this.$emit("update-radius",this.id,this.calcNewRadius(e),!0),this.referenceRadius=0},calcNewRadius(e){return this.referenceRadius?this.referenceRadius-e.dot(this.direction)*this.resizeCoeff:this.radius}},computed:{halfTan(){return Math.tan(h(this.angle)/2)},halfSin(){return Math.sin(h(this.angle)/2)},halfCos(){return Math.cos(h(this.angle)/2)},axTicksCount(){return this.axTicks.length},axTicksReversed(){return this.axTicks.slice().reverse()},direction(){const e=h(this.rotation);return new c(-Math.sin(e),Math.cos(e))},resizeCoeff(){const e=h(this.rotation%90-45);return Math.cos(e)*Math.sqrt(2)},textCurveId(){return this.id+"-text-curve"}}},B=v({...E,__name:"WheelSegment",setup(e){return(t,o)=>(i(),s("div",{class:"wheel-segment",style:d({"--anim-speed":e.animationSpeed,"--radius":e.radius*50+"%","--rotation":e.rotation,"--space":e.space,"--half-sin":t.halfSin,"--half-tan":t.halfTan,"--color":e.color,"--ax-wd":e.axWidth,"--ax-cnt":t.axTicksCount,"--title-frac":e.titleFrac})},[a("div",A,[a("div",F,[R(W,{id:e.id,"main-direction":t.direction,onCursorMove:t.onResize,onCursorDown:t.onResizeStart,onCursorUp:t.onResizeEnd},null,8,["id","main-direction","onCursorMove","onCursorDown","onCursorUp"])])]),a("div",{class:"axis",style:d({"--rotation":e.rotation,"--angle":e.angle})},[(i(!0),s(f,null,m(t.axTicksReversed,(n,r)=>(i(),s("div",{class:"tick",style:d({"--index":r,"--v":"white"})},$(n),5))),256)),(i(!0),s(f,null,m(t.axTicksCount+2,(n,r)=>(i(),s("div",{class:"tick",style:d({"--index":r+t.axTicksCount,"--c":"transparent"})},"a",4))),256))],4),(i(),s("svg",{viewBox:`${-e.titleFrac} ${-e.titleFrac} ${2+2*e.titleFrac} ${2+2*e.titleFrac}`,height:"100%",width:"100%"},[a("path",{id:t.textCurveId,fill:"none",d:`M ${1-t.halfSin} ${1-t.halfCos} A 1 1 0 0 1 ${1+t.halfSin} ${1-t.halfCos}`},null,8,j),a("text",P,[a("textPath",k({"xlink:href":"#"+t.textCurveId},{"font-size":1.6*e.titleFrac,"start-offset":"5"}),$(e.title),17,U)])],8,N))],4))}});const I=g(B,[["__scopeId","data-v-337b0661"]]),Y={props:{maxValue:{default:10},minValue:{default:1},valueStep:{default:1},space:{type:String,default:"0.5em"},sectors:{type:Object,default:{el1:new S("el1",5,"El #1",p()),el2:new S("el1",7,"El #2",p())}},mainRotation:{type:Number,default:0},sectorTitleFrac:{type:Number,default:.05}},emits:["change-value","change-rotation"],computed:{nitems(){return Object.keys(this.items).length},angle(){return 360/this.nitems},axisTicks(){if(!this.valueStep)return[this.minValue,this.maxValue];let e=[];for(let t=this.minValue;t<=this.maxValue;t+=this.valueStep)e.push(t);return e},items(){const e=this.sectors;let t={};return Object.keys(e).forEach(function(o){t[o]=e[o]}),t}},methods:{calcRotation(e){return e*this.angle+this.mainRotation},rotate(e,t){if(t===void 0&&e){let o=-this.angle*(e.id-1),n=Math.floor((o-this.mainRotation)/360);o-=360*n,n=Math.abs(o-this.mainRotation),n>Math.abs(n-360)&&(o-=360),this.$emit("change-rotation",o)}else t!==void 0&&this.$emit("change-rotation",w(this.mainRotation+t*this.angle,0,this.angle))},resizeSegment(e,t,o=!0){console.log(`new Radius = ${t}`);let n=(this.maxValue+1)*t-1;o&&(n=w(n,this.minValue,this.valueStep)),n=T(n,this.minValue,this.maxValue),console.log(`new vals: ${e}, ${n}`),this.$emit("change-value",e,n)},onScroll(e){this.rotate(void 0,Math.sign(e.deltaY))},onClick(e,t){console.log(`clicked id: ${t}`)}}},O=v({...Y,__name:"Wheel",setup(e){return(t,o)=>(i(),s("div",{class:"wheel",onMousewheel:o[0]||(o[0]=(...n)=>t.onScroll&&t.onScroll(...n))},[(i(!0),s(f,null,m(t.items,(n,r,l)=>(i(),x(I,{key:n.id,draggable:"false",onClick:u=>t.onClick(u,n.id),onUpdateRotation:t.rotate,onUpdateRadius:t.resizeSegment,id:n.id,rotation:t.calcRotation(l),angle:t.angle,space:e.space,radius:(n.value+1)/(e.maxValue+1),title:n.title,color:n.color,"ax-ticks":t.axisTicks,"title-frac":e.sectorTitleFrac},null,8,["onClick","onUpdateRotation","onUpdateRadius","id","rotation","angle","space","radius","title","color","ax-ticks","title-frac"]))),128)),(i(!0),s(f,null,m(t.axisTicks,n=>(i(),s("div",{key:n,class:"overlay",style:d({"--value":n,"--max-value":e.maxValue,"--title-frac":e.sectorTitleFrac})},null,4))),128))],32))}});const X=z("interface",{state:()=>({wheelRotation:0})}),q=e=>(_("data-v-f232ae2a"),e=e(),b(),e),L={class:"wheel-view"},G=q(()=>a("h1",{class:"wheel-header"},"The Wheel of Balance",-1)),H={props:{},data(){return{wheels:C(),interface:X()}},methods:{changeRotation(e){this.interface.wheelRotation=e}}},J=v({...H,__name:"WheelView",setup(e){return(t,o)=>(i(),s("div",L,[G,R(O,{class:"wheel-body",sectors:t.wheels.sectors,"min-value":t.wheels.minValue,"max-value":t.wheels.maxValue,"main-rotation":t.interface.wheelRotation,onChangeValue:t.wheels.setSectorValue,onChangeRotation:t.changeRotation},null,8,["sectors","min-value","max-value","main-rotation","onChangeValue","onChangeRotation"])]))}});const Z=g(J,[["__scopeId","data-v-f232ae2a"]]);export{Z as default};
