import{P as l,C as R,a as h,W as S,r as v,t as w,c as T,u as $}from"./wheel-f8354381.js";import{u as M,_ as g,o as n,c as r,d as p,a as u,b as _,n as c,F as d,r as m,t as x,e as z,p as C,f as k}from"./index-580d4d47.js";const V={props:{id:{required:!0},mainDirection:{type:l,default:null,required:!1}},data(){return{resizeStartAnchor:null,currentTouch:null}},computed:{cursorStore(){return M()}},emits:["cursor-move","cursor-down","cursor-up"],methods:{onMouseDown(e){console.log("mouse-down"),this._cursorDown(e.clientX,e.clientY)},onMouseUp(e){console.log("mouse-up"),this._cursorUp(e.clientX,e.clientY)},onMouseMove(e){console.log("mouse-move"),this._cursorMove(e.clientX,e.clientY)},onTouchStart(e){e.preventDefault(),console.log("touch-down"),e.touches.length>0&&(this.currentTouch=e.touches[0],this._cursorDown(this.currentTouch.clientX,this.currentTouch.clientY))},onTouchMove(e){if(console.log("touch-move"),!this.currentTouch)return;const t=e.changedTouches;for(let o=0;o<t.length;o++)if(this.currentTouch.identifier===t[o].identifier){this._cursorMove(t[o].clientX,t[o].clientY);return}},onTouchEnd(e){if(console.log("touch-end"),!this.currentTouch)return;const t=e.changedTouches;for(let o=0;o<t.length;o++)if(this.currentTouch.identifier===t[o].identifier){this._cursorUp(t[o].clientX,t[o].clientY);return}},_cursorDown(e,t){this.resizeStartAnchor=this.toRelative(e,t);const[o,s]=this.toProjected(this.resizeStartAnchor);this.$emit("cursor-down",o,s),this.cursorStore.root&&(this.cursorStore.root.onmousemove=this.onMouseMove,this.cursorStore.root.onmouseup=this.onMouseUp,this.cursorStore.root.ontouchmove=this.onTouchMove,this.cursorStore.root.ontouchend=this.onTouchEnd)},_cursorMove(e,t){if(!this.resizeStartAnchor)return;const o=this.toRelative(e,t).subtract(this.resizeStartAnchor),[s,i]=this.toProjected(o);this.$emit("cursor-move",s,i)},_cursorUp(e,t){if(this.resizeStartAnchor){const o=this.toRelative(e,t).subtract(this.resizeStartAnchor),[s,i]=this.toProjected(o);this.$emit("cursor-up",s,i)}this.resizeStartAnchor=null,this.cursorStore.root&&(this.cursorStore.root.onmousemove=null,this.cursorStore.root.onmouseup=null)},centeredRect(){let e=this.$el.getBoundingClientRect();return console.log(`rect: ${e.left} ${e.top} ${e.right} ${e.bottom}`),new R(new l((e.right+e.left)/2,(e.bottom+e.top)/2),new l((e.right-e.left)/2,(e.bottom-e.top)/2))},toRelative(e,t){let o=this.centeredRect();console.log(`Client pointer=[${e}, ${t}]`),console.log(`centered rect: center=[${o.center.x}, ${o.center.y}] halfSize=[${o.halfSize.x}, ${o.halfSize.y}]`);const s=new l((e-o.center.x)/o.halfSize.x,(t-o.center.y)/o.halfSize.y);return console.log(`relative [${s.x}, ${s.y}]`),s},toProjected(e){if(!this.mainDirection)return[e,new l(0,0)];const t=e.projectOn(this.mainDirection),o=e.subtract(t);return console.log(`Projection [${t.x}, ${t.y}]`),[t,o]}}};function b(e,t,o,s,i,a){return n(),r("div",{class:"resize-eventor-root",onMousedown:t[0]||(t[0]=(...f)=>a.onMouseDown&&a.onMouseDown(...f)),onTouchstart:t[1]||(t[1]=(...f)=>a.onTouchStart&&a.onTouchStart(...f))},null,32)}const D=g(V,[["render",b]]),W={class:"inner"},j={props:{id:{type:String,default:"0"},title:{type:String,default:"Some Title"},radius:{type:Number,default:1},rotation:{type:Number,default:0},angle:{type:Number,default:90},space:{type:String,default:"1rem"},axWidth:{type:String,default:"0.2rem"},axTicks:{default:()=>[0,10]},color:{type:String,default:"#af0000"},animationSpeed:{type:String,default:"0.5s"}},emits:["update-rotation","update-radius"],mounted(){console.log(`Created sector ${this.title} with radiusScale=${this.radius}`)},data(){return{referenceRadius:0}},methods:{onResize(e,t){console.log(`New Point: ${e.x}, ${e.y}, diag=${e.diag()}`),this.$emit("update-radius",this.id,this.calcNewRadius(e),!1)},onResizeStart(){this.referenceRadius=this.radius},onResizeEnd(e,t){this.$emit("update-radius",this.id,this.calcNewRadius(e),!0),this.referenceRadius=0},calcNewRadius(e){return this.referenceRadius?this.referenceRadius-e.dot(this.direction)*this.resizeCoeff:this.radius}},computed:{halfTan(){return Math.tan(h(this.angle)/2)},halfSin(){return Math.sin(h(this.angle)/2)},axTicksCount(){return this.axTicks.length},axTicksReversed(){return this.axTicks.slice().reverse()},direction(){const e=h(this.rotation);return new l(-Math.sin(e),Math.cos(e))},resizeCoeff(){const e=h(this.rotation%90-45);return Math.cos(e)*Math.sqrt(2)}}},A=p({...j,__name:"WheelSegment",setup(e){return(t,o)=>(n(),r("div",{class:"wheel-segment",style:c({"--anim-speed":e.animationSpeed})},[u("div",{class:"outer",style:c({"--radius":e.radius*50+"%","--rotation":e.rotation,"--space":e.space,"--half-sin":t.halfSin,"--half-tan":t.halfTan,"--color":e.color,"--ax-wd":e.axWidth,"--ax-cnt":t.axTicksCount})},[u("div",W,[_(D,{id:e.id,"main-direction":t.direction,onCursorMove:t.onResize,onCursorDown:t.onResizeStart,onCursorUp:t.onResizeEnd},null,8,["id","main-direction","onCursorMove","onCursorDown","onCursorUp"])])],4),u("div",{class:"axis",style:c({"--rotation":e.rotation,"--angle":e.angle})},[(n(!0),r(d,null,m(t.axTicksReversed,(s,i)=>(n(),r("div",{class:"tick",style:c({"--index":i,"--v":"white"})},x(s),5))),256)),(n(!0),r(d,null,m(t.axTicksCount+2,(s,i)=>(n(),r("div",{class:"tick",style:c({"--index":i+t.axTicksCount,"--c":"transparent"})},"a",4))),256))],4)],4))}});const U=g(A,[["__scopeId","data-v-9e161448"]]),E={props:{maxValue:{default:10},minValue:{default:1},valueStep:{default:1},space:{type:String,default:"0.5em"},sectors:{type:Object,default:{el1:new S("el1",5,"El #1",v()),el2:new S("el1",7,"El #2",v())}}},emits:["change-value"],data(){return{mainRotation:0}},computed:{nitems(){return Object.keys(this.items).length},angle(){return 360/this.nitems},axisTicks(){if(!this.valueStep)return[this.minValue,this.maxValue];let e=[];for(let t=this.minValue;t<=this.maxValue;t+=this.valueStep)e.push(t);return e},items(){const e=this.sectors;let t={};return Object.keys(e).forEach(function(o){t[o]=e[o]}),t}},methods:{calcRotation(e){return e*this.angle+this.mainRotation},rotate(e,t){if(t===void 0&&e){let o=-this.angle*(e.id-1),s=Math.floor((o-this.mainRotation)/360);o-=360*s,s=Math.abs(o-this.mainRotation),s>Math.abs(s-360)&&(o-=360),this.mainRotation=o}else t!==void 0&&(this.mainRotation=w(this.mainRotation+t*this.angle,0,this.angle))},resizeSegment(e,t,o=!0){console.log(`new Radius = ${t}`);let s=(this.maxValue+1)*t-1;o&&(s=w(s,this.minValue,this.valueStep)),s=T(s,this.minValue,this.maxValue),console.log(`new vals: ${e}, ${s}`),this.$emit("change-value",e,s)},onScroll(e){this.rotate(void 0,Math.sign(e.deltaY))}}},N=p({...E,__name:"Wheel",setup(e){return(t,o)=>(n(),r("div",{class:"wheel",onMousewheel:o[0]||(o[0]=(...s)=>t.onScroll&&t.onScroll(...s))},[(n(!0),r(d,null,m(t.items,(s,i,a)=>(n(),z(U,{key:s.id,draggable:"false",onUpdateRotation:t.rotate,onUpdateRadius:t.resizeSegment,id:s.id,rotation:t.calcRotation(a),angle:t.angle,space:e.space,radius:(s.value+1)/(e.maxValue+1),title:s.title,color:s.color,"ax-ticks":t.axisTicks},null,8,["onUpdateRotation","onUpdateRadius","id","rotation","angle","space","radius","title","color","ax-ticks"]))),128)),(n(!0),r(d,null,m(t.axisTicks,s=>(n(),r("div",{key:s,class:"overlay",style:c({"--value":s,"--max-value":e.maxValue})},null,4))),128))],32))}});const y=e=>(C("data-v-c5465502"),e=e(),k(),e),P={class:"wheel-view"},Y=y(()=>u("h1",{class:"wheel-header"},"The Wheel of Balance",-1)),B=y(()=>u("h1",{class:"wheel-footer"},"Some interface here",-1)),O={props:{},data(){return{mainRotation:0,wheels:$()}},methods:{onChangeSectorSize(e,t){this.wheels.setSectorValue(e,t)}}},X=p({...O,__name:"WheelView",setup(e){return(t,o)=>(n(),r("div",P,[Y,_(N,{class:"wheel-body",sectors:t.wheels.getSectors(),onChangeValue:t.onChangeSectorSize},null,8,["sectors","onChangeValue"]),B]))}});const F=g(X,[["__scopeId","data-v-c5465502"]]);export{F as default};
